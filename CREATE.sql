CREATE TABLE _user (
	id BIGINT NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	nickname VARCHAR(255) NOT NULL,
	login VARCHAR(255) NOT NULL UNIQUE,
	password VARCHAR(255) NOT NULL,
    refresh_token_id BIGINT,
	PRIMARY KEY("id")
);

CREATE TABLE Refresh_token (
    id BIGSERIAL PRIMARY KEY,
    token VARCHAR(255) NOT NULL UNIQUE,
    expires_at TIMESTAMP NOT NULL
);

CREATE TABLE Board (
	id UUID NOT NULL UNIQUE,
	title VARCHAR(255) NOT NULL,
	author_id BIGINT,
	is_progress BOOLEAN NOT NULL,
    created_at TIMESTAMP NOT NULL,
	ended_at TIMESTAMP,
	invite_edit_token UUID NOT NULL,
	PRIMARY KEY(id)
);

CREATE TABLE User_Board (
	id BIGINT NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	user_id BIGINT NOT NULL,
	board_id UUID NOT NULL,
	PRIMARY KEY(id)
);

CREATE TABLE Component (
	id UUID NOT NULL UNIQUE,
	title TEXT NOT NULL,
	description TEXT,
	type VARCHAR(255) NOT NULL,
	source_id BIGINT,
	x REAL NOT NULL,
	y REAL NOT NULL,
	board_id UUID,
	author_id BIGINT,
	is_anonymous_author BOOLEAN NOT NULL,
	is_anonymous_votes BOOLEAN NOT NULL,
	PRIMARY KEY(id)
);

CREATE TABLE Vote (
	id BIGINT NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	user_id BIGINT NOT NULL,
	component_id UUID NOT NULL,
	PRIMARY KEY(id)
);

CREATE TABLE SVG_Template (
	id BIGINT NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	source TEXT NOT NULL,
	type VARCHAR(255) NOT NULL,
	PRIMARY KEY("id")
);

ALTER TABLE _user
ADD FOREIGN KEY(refresh_token_id) REFERENCES Refresh_token(id)
ON UPDATE NO ACTION ON DELETE SET NULL;

ALTER TABLE Board
ADD FOREIGN KEY(author_id) REFERENCES _user(id)
ON UPDATE NO ACTION ON DELETE SET NULL;

ALTER TABLE User_Board
ADD FOREIGN KEY(user_id) REFERENCES _user(id)
ON UPDATE NO ACTION ON DELETE SET NULL;

ALTER TABLE User_Board
ADD FOREIGN KEY(board_id) REFERENCES Board(id)
ON UPDATE NO ACTION ON DELETE CASCADE;

ALTER TABLE Component
ADD FOREIGN KEY(board_id) REFERENCES Board(id)
ON UPDATE NO ACTION ON DELETE CASCADE;

ALTER TABLE Vote
ADD FOREIGN KEY(user_id) REFERENCES _user(id)
ON UPDATE NO ACTION ON DELETE CASCADE;

ALTER TABLE Vote
ADD FOREIGN KEY(component_id) REFERENCES Component(id)
ON UPDATE NO ACTION ON DELETE CASCADE;

ALTER TABLE Component
ADD FOREIGN KEY(author_id) REFERENCES _user(id)
ON UPDATE NO ACTION ON DELETE NO ACTION;

ALTER TABLE Component
ADD FOREIGN KEY("source_id") REFERENCES SVG_Template(id)
ON UPDATE NO ACTION ON DELETE SET NULL;